<div class="card shadow" style="max-width: 450px; border-radius: 12px;">
  <div class="card-body p-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="card-title mb-0">SQL Injection</h4>
      <button type="button" class="btn btn-link p-0 text-secondary d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;" (click)="toggleModal()" title="Help">
        <i class="bi bi-question-circle fs-4"></i>
      </button>
    </div>
    <div class="content-area">
      @if (isGoodImplementation) {
        <!-- Good Implementation -->
        <form #goodForm="ngForm">
          <div class="mb-3">
            <label for="usernameGood" class="form-label">Username</label>
            <input type="text" class="form-control" id="usernameGood" name="username" placeholder="Enter text" [(ngModel)]="goodUsername">
          </div>
          <div class="mb-3">
            <label for="passwordGood" class="form-label">Password</label>
            <input type="password" class="form-control" id="passwordGood" name="password" placeholder="Enter text" [(ngModel)]="goodPassword">
          </div>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-secondary flex-fill" (click)="clearForm(goodForm)">Clear</button>
            <button type="button" class="btn btn-success flex-fill" (click)="OnGoodSubmit()">Login</button>
          </div>
        </form>
      } @else {
        <!-- Bad Implementation -->
        <form #badForm="ngForm">
          <div class="mb-3">
            <label for="usernameBad" class="form-label">Username</label>
            <input type="text" class="form-control" id="usernameBad" name="username" placeholder="Enter text" [(ngModel)]="goodUsername">
          </div>
          <div class="mb-3">
            <label for="passwordBad" class="form-label">Password</label>
            <input type="text" class="form-control" id="passwordBad" name="password" placeholder="Enter text" [(ngModel)]="goodPassword">
          </div>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-secondary flex-fill" (click)="clearForm(badForm)">Clear</button>
            <button type="button" class="btn btn-success flex-fill" (click)="OnBadSubmit()">Login</button>
          </div>
        </form>
      }
    </div>
  </div>
</div>

<!-- Help Modal -->
@if (showModal) {
  <div class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background-color: rgba(0,0,0,0.5); z-index: 1050;" (click)="toggleModal()">
    <div class="bg-white rounded shadow" style="width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;" (click)="$event.stopPropagation()">
      <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
        <h5 class="mb-0">
          @if (isGoodImplementation) {
            Why This Implementation is Secure
          } @else {
            Try These Exploits
          }
        </h5>
        <button type="button" class="btn-close" (click)="toggleModal()" aria-label="Close"></button>
      </div>
      <div class="p-3">
        @if (isGoodImplementation) {
          <!-- Good Implementation - Show why exploit steps don't work -->
          <div>
            <h6 class="text-success fw-bold">SQL Injection Attack - Why It Fails:</h6>
            <p class="text-muted mb-3">This implementation uses parameterized queries, preventing SQL injection attempts.</p>
            
            <div class="mb-3 p-3 bg-light rounded position-relative border-start border-success border-4" style="padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #d1e7dd; color: #0a3622;">1</span>
              <strong class="d-block mb-1">Attempting boolean-based injection:</strong>
              <code class="d-block p-2 rounded mb-1" style="background-color: #e7f5ff; color: #0066cc; overflow-x: auto;">' OR '1'='1</code>
              <p class="text-success mb-0 small">Parameterized queries treat this as literal string data, not SQL logic. The query searches for a user with this exact string as their username.</p>
            </div>
            
            <div class="mb-3 p-3 bg-light rounded position-relative border-start border-success border-4" style="padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #d1e7dd; color: #0a3622;">2</span>
              <strong class="d-block mb-1">Trying comment-based bypass:</strong>
              <code class="d-block p-2 rounded mb-1" style="background-color: #e7f5ff; color: #0066cc; overflow-x: auto;">admin'--</code>
              <p class="text-success mb-0 small">The parameter is safely escaped, so the comment syntax is treated as part of the username string, not as SQL comments.</p>
            </div>
            
            <div class="mb-3 p-3 bg-light rounded position-relative border-start border-success border-4" style="padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #d1e7dd; color: #0a3622;">3</span>
              <strong class="d-block mb-1">Using alternate boolean injection:</strong>
              <code class="d-block p-2 rounded mb-1" style="background-color: #e7f5ff; color: #0066cc; overflow-x: auto;">' OR 1=1--</code>
              <p class="text-success mb-0 small">Prepared statements separate data from code, so this is treated as a literal string value, not executable SQL.</p>
            </div>
            
            <div class="mb-3 p-3 bg-light rounded position-relative border-start border-success border-4" style="padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #d1e7dd; color: #0a3622;">4</span>
              <strong class="d-block mb-1">Attempting UNION-based data extraction:</strong>
              <code class="d-block p-2 rounded mb-1" style="background-color: #e7f5ff; color: #0066cc; overflow-x: auto;">' UNION SELECT username, password, id FROM users--</code>
              <p class="text-success mb-0 small">Query parameterization prevents this from being interpreted as SQL, treating the entire input as a string literal.</p>
            </div>
          </div>
        } @else {
          <!-- Bad Implementation - Show step-by-step exploit -->
          <div>
            <h6 class="text-danger fw-bold">SQL Injection Exploit - Follow These Steps:</h6>
            <p class="text-muted mb-3">This implementation doesn't use parameterized queries, making it vulnerable to SQL injection.</p>
            
            <div class="mb-3 p-3 rounded position-relative border-start border-danger border-4" style="background-color: #fff5f5; padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #f8d7da; color: #58151c;">1</span>
              <strong class="d-block mb-2">Basic boolean-based bypass (Password field):</strong>
              <div class="input-group mb-2">
                <input type="text" class="form-control font-monospace small" style="background-color: white;" [value]="exploitSteps.step1" readonly>
                <button class="btn btn-outline-secondary" (click)="copyToClipboard(exploitSteps.step1, $event)">
                  {{ copiedText === exploitSteps.step1 ? 'Copied!' : 'Copy' }}
                </button>
              </div>
              <p class="text-muted mb-0 small">Copy this into the password field. It closes the password string and adds a condition that's always true, bypassing authentication. Query becomes: <code>... AND password = '' OR '1'='1'</code></p>
            </div>
            
            <div class="mb-3 p-3 rounded position-relative border-start border-danger border-4" style="background-color: #fff5f5; padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #f8d7da; color: #58151c;">2</span>
              <strong class="d-block mb-2">Comment-based login bypass (Username field):</strong>
              <div class="input-group mb-2">
                <input type="text" class="form-control font-monospace small" style="background-color: white;" [value]="exploitSteps.step2" readonly>
                <button class="btn btn-outline-secondary" (click)="copyToClipboard(exploitSteps.step2, $event)">
                  {{ copiedText === exploitSteps.step2 ? 'Copied!' : 'Copy' }}
                </button>
              </div>
              <p class="text-muted mb-0 small">Use in username field, leave password empty. The <code>--</code> comments out everything after, removing the password check entirely. Query becomes: <code>... WHERE username = 'admin'--...</code></p>
            </div>
            
            <div class="mb-3 p-3 rounded position-relative border-start border-danger border-4" style="background-color: #fff5f5; padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #f8d7da; color: #58151c;">3</span>
              <strong class="d-block mb-2">Alternative boolean bypass (Password field):</strong>
              <div class="input-group mb-2">
                <input type="text" class="form-control font-monospace small" style="background-color: white;" [value]="exploitSteps.step3" readonly>
                <button class="btn btn-outline-secondary" (click)="copyToClipboard(exploitSteps.step3, $event)">
                  {{ copiedText === exploitSteps.step3 ? 'Copied!' : 'Copy' }}
                </button>
              </div>
              <p class="text-muted mb-0 small">Similar to #1 but uses <code>1=1</code> instead. Comments out the rest with <code>--</code>. Query becomes: <code>... AND password = '' OR 1=1--...</code> which always returns results.</p>
            </div>
            
            <div class="mb-3 p-3 rounded position-relative border-start border-danger border-4" style="background-color: #fff5f5; padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #f8d7da; color: #58151c;">4</span>
              <strong class="d-block mb-2">UNION-based data extraction (Username field):</strong>
              <div class="input-group mb-2">
                <input type="text" class="form-control font-monospace small" style="background-color: white;" [value]="exploitSteps.step4" readonly>
                <button class="btn btn-outline-secondary" (click)="copyToClipboard(exploitSteps.step4, $event)">
                  {{ copiedText === exploitSteps.step4 ? 'Copied!' : 'Copy' }}
                </button>
              </div>
              <p class="text-muted mb-0 small">Advanced attack that extracts all usernames and passwords from the database. Uses UNION to combine results with a second query that dumps the entire users table.</p>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
}