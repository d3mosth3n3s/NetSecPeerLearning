<div class="card ig-card shadow">
  <div class="card-body p-3">
    <div class="d-flex justify-content-between align-items-center mb-3 position-relative">
      <div class="auth-flag">
        <i class="bi bi-exclamation"></i>
        <span class="flag-text"> Note how you are <b>not</b> Tony or an admin. </span>
      </div>
      <h4 class="mb-0">{{ profile.username }}</h4>
      <div class="mb-0 position-relative">
        <div class="auth-flag-right">
          <i class="bi bi-question"></i>
          <span class="flag-text"> You are in user mode </span>
        </div>
        <span class="badge bg-secondary">{{ currentUser.role }}</span>
      </div>
    </div>

    <div class="mb-3">
      <p class="text-muted small mb-1">Bio</p>
      <p class="mb-0">{{ profile.bio }}</p>
    </div>

    <div class="d-flex gap-2 mb-3 position-relative">
      <div class="auth-flag">
        <i class="bi bi-question"></i>
        <span class="flag-text"> You are viewing Tony's profile. Editing is restricted. </span>
      </div>
      <button class="btn btn-outline-secondary flex-fill" [disabled]="!canEditProfile">
        Edit Profile
      </button>

      <button class="btn btn-outline-secondary flex-fill" [disabled]="!canEditPosts">
        Edit Posts
      </button>
    </div>

    <div>
      <p class="fw-bold small mb-2">Posts</p>

      <div class="post-card" *ngFor="let post of profile.posts">
        <p class="mb-1">{{ post.caption }}</p>
        <span class="text-muted small">❤️ {{ post.likes }} likes</span>
      </div>
    </div>

    <div class="mt-4 position-relative">
      <div class="auth-flag">
        <i class="bi bi-exclamation"></i>
        <span class="flag-text"> Only admins are allowed to change someone's profile. </span>
      </div>
      <button class="btn btn-danger w-100" (click)="attemptAdminAccess()">Log in as Admin</button>
    </div>
  </div>
</div>

@if (showModal) {
  <div class="modal-backdrop-custom" (click)="toggleModal()">
    <div class="modal-card" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h5 class="mb-0">Why This Is Secure</h5>
        <button class="btn-close" (click)="toggleModal()"></button>
      </div>

      <div class="modal-body">
        <div class="explain success">
          <h6>Unauthorized Profile Access Blocked</h6>
          <p>
            Users can view public content, but cannot edit profiles or posts unless they are the
            owner or have elevated permissions.
          </p>
        </div>

        <div class="explain success">
          <h6>Authorization Is Enforced in Logic</h6>
          <p>
            Buttons are disabled in the UI and also protected in component logic, preventing bypass
            via DOM manipulation.
          </p>
        </div>
        <div class="explain success">
          <h6>Uhh something something else</h6>
          <p>Uhh ummm uhh idk</p>
        </div>
      </div>
    </div>
  </div>
}
