<div class="card shadow" style="max-width: 450px; border-radius: 12px;">
  <div class="card-body p-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="card-title mb-0">Cross-site Scripting</h4>
      <button type="button" class="btn btn-link p-0 text-secondary d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;" (click)="toggleModal()" title="Help">
        <i class="bi bi-question-circle fs-4"></i>
      </button>
    </div>
    <div class="content-area">
      @if (isGoodImplementation) {
        <!-- Good Implementation -->
        <form>
          <div class="mb-3">
            <label for="textInputGood" class="form-label">Text Input</label>
            <input type="text" class="form-control" id="textInputGood" placeholder="Enter text" [(ngModel)]="textInputGood" name="textInputGood" maxlength="50" (keydown)="onKeyDown($event)" (paste)="onPaste($event)" autocomplete="off">
          </div>
          
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-secondary flex-fill" (click)="clearInput()">Clear</button>
            <button type="button" class="btn btn-success flex-fill" (click)="onGoodSubmit()">Save</button>
          </div>
        </form>
      } @else {
        <!-- Bad Implementation -->
        <form>
          <div class="mb-3">
            <label for="textInputBad" class="form-label">Text Input</label>
            <input type="text" class="form-control" id="textInputBad" placeholder="Enter text" [(ngModel)]="textInputBad" name="textInputBad">
          </div>
          
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-secondary flex-fill" (click)="clearInput()">Clear</button>
            <button type="button" class="btn btn-success flex-fill" (click)="onBadSubmit()">Save</button>
          </div>
        </form>
      }
    </div>
  </div>
</div>

<!-- Help Modal -->
@if (showModal) {
  <div class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background-color: rgba(0,0,0,0.5); z-index: 1050;" (click)="toggleModal()">
    <div class="bg-white rounded shadow" style="width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;" (click)="$event.stopPropagation()">
      <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
        <h5 class="mb-0">
          @if (isGoodImplementation) {
            Why This Implementation is Secure
          } @else {
            Try These Exploits
          }
        </h5>
        <button type="button" class="btn-close" (click)="toggleModal()" aria-label="Close"></button>
      </div>
      <div class="p-3">
        @if (isGoodImplementation) {
          <!-- Good Implementation - Show why XSS attacks are prevented -->
          <div>
            <h6 class="text-success fw-bold">XSS Attack Prevention - How It Works:</h6>
            <p class="text-muted mb-3">This implementation uses multiple layers of security to prevent Cross-Site Scripting attacks.</p>
            
            <div class="mb-3 p-3 bg-light rounded position-relative border-start border-success border-4" style="padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #d1e7dd; color: #0a3622;">1</span>
              <strong class="d-block mb-1">Client-Side Input Blocking:</strong>
              <p class="text-success mb-0 small">Special characters like &lt;, &gt;, ", ', &, and others are blocked from being typed or pasted into the input field. This prevents malicious HTML or script tags from being entered.</p>
            </div>
            
            <div class="mb-3 p-3 bg-light rounded position-relative border-start border-success border-4" style="padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #d1e7dd; color: #0a3622;">2</span>
              <strong class="d-block mb-1">Server-Side Validation:</strong>
              <p class="text-success mb-0 small">The backend validates all inputs, rejecting any that contain special characters or exceed 50 characters. This ensures malicious payloads can't bypass client-side checks.</p>
            </div>
            
            <div class="mb-3 p-3 bg-light rounded position-relative border-start border-success border-4" style="padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #d1e7dd; color: #0a3622;">3</span>
              <strong class="d-block mb-1">Parameterized Database Queries:</strong>
              <p class="text-success mb-0 small">Database functions safely store and retrieve data using parameterized queries, ensuring malicious scripts are treated as plain text data rather than executable code.</p>
            </div>
            
            <div class="mb-3 p-3 bg-light rounded position-relative border-start border-success border-4" style="padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #d1e7dd; color: #0a3622;">4</span>
              <strong class="d-block mb-1">Angular Template Escaping:</strong>
              <p class="text-success mb-0 small">Angular automatically escapes HTML in templates using double curly brace interpolation, preventing any stored malicious scripts from executing when displayed to users.</p>
            </div>
          </div>
        } @else {
          <!-- Bad Implementation - Show step-by-step exploit -->
          <div>
            <h6 class="text-danger fw-bold">Command Injection Exploit - Follow These Steps:</h6>
            <p class="text-muted mb-3">This implementation doesn't properly validate inputs, making it vulnerable to command injection.</p>
            
            <div class="mb-3 p-3 rounded position-relative border-start border-danger border-4" style="background-color: #fff5f5; padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #f8d7da; color: #58151c;">1</span>
              <strong class="d-block mb-2">Inject a basic command to verify vulnerability:</strong>
              <div class="input-group mb-2">
                <input type="text" class="form-control font-monospace small" style="background-color: white;" [value]="exploitSteps.step1" readonly>
                <button class="btn btn-outline-secondary" (click)="copyToClipboard(exploitSteps.step1, $event)">
                  {{ copiedText === exploitSteps.step1 ? 'Copied!' : 'Copy' }}
                </button>
              </div>
              <p class="text-muted mb-0 small">Copy and paste this into the text input field. The semicolon allows command chaining, so 'whoami' will execute after the legitimate input.</p>
            </div>
            
            <div class="mb-3 p-3 rounded position-relative border-start border-danger border-4" style="background-color: #fff5f5; padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #f8d7da; color: #58151c;">2</span>
              <strong class="d-block mb-2">List sensitive directory contents:</strong>
              <div class="input-group mb-2">
                <input type="text" class="form-control font-monospace small" style="background-color: white;" [value]="exploitSteps.step2" readonly>
                <button class="btn btn-outline-secondary" (click)="copyToClipboard(exploitSteps.step2, $event)">
                  {{ copiedText === exploitSteps.step2 ? 'Copied!' : 'Copy' }}
                </button>
              </div>
              <p class="text-muted mb-0 small">This payload uses command substitution to execute 'ls' on the parent directory, revealing the application's file structure.</p>
            </div>
            
            <div class="mb-3 p-3 rounded position-relative border-start border-danger border-4" style="background-color: #fff5f5; padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #f8d7da; color: #58151c;">3</span>
              <strong class="d-block mb-2">Exfiltrate sensitive data:</strong>
              <div class="input-group mb-2">
                <input type="text" class="form-control font-monospace small" style="background-color: white;" [value]="exploitSteps.step3" readonly>
                <button class="btn btn-outline-secondary" (click)="copyToClipboard(exploitSteps.step3, $event)">
                  {{ copiedText === exploitSteps.step3 ? 'Copied!' : 'Copy' }}
                </button>
              </div>
              <p class="text-muted mb-0 small">The pipe operator redirects output. This reads the password file and sends it to an external server (replace 'attacker.com' with your test endpoint).</p>
            </div>
            
            <div class="mb-3 p-3 rounded position-relative border-start border-danger border-4" style="background-color: #fff5f5; padding-left: 3.5rem !important;">
              <span class="position-absolute top-0 start-0 m-3 rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 32px; height: 32px; background-color: #f8d7da; color: #58151c;">4</span>
              <strong class="d-block mb-2">Execute multiple commands:</strong>
              <div class="input-group mb-2">
                <input type="text" class="form-control font-monospace small" style="background-color: white;" [value]="exploitSteps.step4" readonly>
                <button class="btn btn-outline-secondary" (click)="copyToClipboard(exploitSteps.step4, $event)">
                  {{ copiedText === exploitSteps.step4 ? 'Copied!' : 'Copy' }}
                </button>
              </div>
              <p class="text-muted mb-0 small">Chain multiple commands using && operators to perform complex attacks like creating backdoors or modifying system files.</p>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
}
